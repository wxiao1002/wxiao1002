# Pod

## 简单介绍

- 对于k8s 而言，是最小的部署单位
- 是一组容器的集合，可以是一个容器，也可以是多个容器的集合
- Pod 内多个容器共享网络
- 生命周期是短暂的


每个Pod 里面运行这一个特殊的被称为Pause的容器，其他容器则为业务容器，这些业务容器共享Pause容器的网络栈和Volume挂载卷。<br/>
因此他们之间通信和数据交换更为高效，在设计时候我们可以充分利用这一特性将一组密切相关的服务进程放入同一个Pod 中 <br/>
同一个Pod 里的容器之间通过localhost 就能相互通信，当然要注意端口冲突的问题 <br/>

kubernetes 为Pod 设计了一套独特的网络配置，包括为每个Pod 分配一个IP 地址，使用Pod 名做为容器间通信的主机名<br/>

一个Pod 中应用容器共享一组资源： 共享网络，共享存储
    - 共享网络
    
        通过Pasuse 网络栈容器，把其他业务容器归纳到Pause 容器里面，Pasuse 可以让这些容器都初一同一个namesoace 名车个空间中，从而实现网络共享
    
    - 共享存储

        引入数据卷轴的概念 Volumn, 使用数据卷轴进行数据的持久化

![](https://img2020.cnblogs.com/blog/1526344/202012/1526344-20201229221449777-635369447.png)


## Pod 的特性 

### 网络共享要存储共享

一个Pod 里面的多个容器可以共享存储和网络，可以看作一个逻辑的主机。共享的如namespace,group或者其他隔离资源<br/>

多个容器共享同一个 network namespace, 由此在一个Pod 中多个容器共享Pod ip和端口的namespace,所以一个Pod内的多个容器间可以通过localhost 进行通信，所以需要注意的是不同容器要注意不要有端口冲突
<p>不同的Pod 有不同的IP,不同Pod 内多个容器间惊醒通信，不可以使用IPC通信，通常情况下使用Pod 的IP 通信</p>

一个Pod 里面的多个容器可以共享存储卷，这个存储卷会被定义为Pod 一部分，并且可以挂载到该Pod 里的所有容器的文件系统上

![](https://img2020.cnblogs.com/blog/1526344/202101/1526344-20210118163340529-681670587.png)

![](https://img2020.cnblogs.com/blog/1526344/202101/1526344-20210118165752210-922424351.png)

### Pod 的状态和策略

- pod 的状态

| 状态        | 说明                                             |
|-----------|------------------------------------------------|
| Pending   | API Server已经创建好该Pod，但是Pod中的一个或者多个容器镜像还没有下载或者创建 | 
| Running   | Pod 内所欲容器已经创建，至少一个容器处于运行状态，正在启动状态或者正在重启        |
| Completed | Pod 内所有容器都成功退出，并且不会自动重启                        |
| Failed    | Pod 内所有容器都成功退出，但一个或者多个容器退出失败                   |
| Unknown   | 位置异常无法获取Pod 的状态，比如网络问题                         |


- Pod 重启策略

restartPolicy : Always|Never|OnFailure 默认值是Always

| 重启策略      | 说明                                 |
|-----------|------------------------------------|
| Always    | 当容器失效时，总是有kubelet 自动重启             |
| Never     | 无论容器运行状态如何，kubelet 都不会重启该容器        |
| OnFailure | 当容器终止运行且退出码不为0的时候，由kubelet 自动重启该容器 |

- Pod 镜像拉取策略

imagesPullPolicy: Always | Never | IfNotPresent 获取容器镜像策略


| 重启策略         | 说明                    |
|--------------|-----------------------|
| Always       | 每次都会拉取新镜像             |
| Never        | Pod 永远不会主动拉取镜像        |
| IfNotPresent | 默认值，宿主机不存在该镜像时，采取主动拉取 |


### Pod 的资源限制

每个Pod 都可以对齐使用服务器上的计算资源设置限额，k8s 中可以设置限额的计算资源有CPU，Memory 两种




